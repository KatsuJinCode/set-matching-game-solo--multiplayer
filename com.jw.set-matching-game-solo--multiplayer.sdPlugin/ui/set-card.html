<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Set Card Configuration</title>
    <script src="https://sdpi-components.dev/releases/v4/sdpi-components.js"></script>
    <style>
        body {
            margin: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .section {
            margin-bottom: 24px;
            padding: 16px;
            background: #2a2a2a;
            border-radius: 8px;
        }

        .section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #fff;
        }

        .info-text {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
            line-height: 1.4;
        }

        footer {
            margin-top: 24px;
            padding-top: 16px;
            border-top: 1px solid #3a3a3a;
            text-align: center;
            font-size: 11px;
            color: #666;
        }

        footer strong {
            color: #fff;
        }

        .warning {
            background: #4a3020;
            border-left: 3px solid #ff9933;
            padding: 12px;
            margin: 12px 0;
            border-radius: 4px;
            font-size: 12px;
            color: #ffcc99;
        }
    </style>
</head>
<body>
    <div class="section">
        <div class="section-title">Auto-Configuration</div>

        <div class="info-text">
            <strong>✨ Setup is automatic!</strong><br>
            Simply drag 12 instances of this action onto your Stream Deck and they'll auto-configure themselves.
            <br><br>
            1. Drag out 12 actions → Each shows "X out of 12"<br>
            2. Once all 12 are placed → Player selection mode starts<br>
            3. Click colored buttons to swap player positions<br>
            4. Click center "Start Game" button → Countdown begins<br>
            5. Game starts automatically!
        </div>
    </div>

    <div class="section">
        <div class="section-title">Timer Settings</div>

        <sdpi-item label="Buzz Hold Timeout (seconds)">
            <sdpi-range setting="buzzHoldTimeout" min="1" max="10" default="3"></sdpi-range>
        </sdpi-item>

        <div class="info-text">
            How long a player has to release their buzzer after pressing it.
        </div>

        <sdpi-item label="Selection Timeout (seconds)">
            <sdpi-range setting="selectionTimeout" min="2" max="10" default="4"></sdpi-range>
        </sdpi-item>

        <div class="info-text">
            How long a player has to select their 3 cards after releasing the buzzer.
        </div>

        <sdpi-item label="Countdown Duration (seconds)">
            <sdpi-range setting="countdownDuration" min="3" max="10" default="5"></sdpi-range>
        </sdpi-item>

        <div class="info-text">
            How long the pre-game countdown and rules display lasts.
        </div>
    </div>

    <div class="section">
        <div class="section-title">How to Play</div>

        <div class="info-text">
            <strong>Setup Phase:</strong><br>
            • Drag 12 instances → Auto-configures card positions<br>
            • Player selection → Click colored buttons to choose positions<br>
            • Default positions: Corners (0, 3, 8, 11) for 4 players<br>
            • Click center "Start Game" → Countdown begins<br>
            <br>
            <strong>Gameplay:</strong><br>
            • Green border = game is live, buzz in allowed<br>
            • Press and HOLD your player button to buzz in<br>
            • Screen blacks out, only your color shows<br>
            • Release within {buzzHoldTimeout}s or lose turn<br>
            • After release: 1s to show winner<br>
            • Then {selectionTimeout}s to select 3 cards<br>
            • Valid set ✓ adds point, invalid/timeout ✗ adds miss<br>
            • 1s cooldown animation, then back to live<br>
            <br>
            <strong>Valid Set Rules:</strong><br>
            Each property must be all SAME or all DIFFERENT:<br>
            • Shape: Diamond, Oval, Squiggle<br>
            • Color: Red, Green, Purple<br>
            • Count: 1, 2, 3<br>
            • Fill: Solid, Striped, Empty
        </div>
    </div>

    <footer>
        Build: <strong id="buildNumber">0.1.0</strong>
    </footer>

    <script>
        // Update build number from manifest
        fetch('../manifest.json')
            .then(res => res.json())
            .then(manifest => {
                document.getElementById('buildNumber').textContent = manifest.Version || '0.1.0';
            })
            .catch(() => {
                // Ignore errors, keep default version
            });

        // Listen for timer settings changes and send to plugin
        window.addEventListener('message', (event) => {
            if (event.data.event === 'didReceiveSettings') {
                const settings = event.data.payload.settings;

                // Check if timer settings changed
                if (settings.buzzHoldTimeout !== undefined ||
                    settings.selectionTimeout !== undefined ||
                    settings.countdownDuration !== undefined) {

                    // Send to plugin to update game state
                    if (websocket && websocket.readyState === WebSocket.OPEN) {
                        websocket.send(JSON.stringify({
                            event: 'sendToPlugin',
                            context: context,
                            payload: {
                                action: 'updateTimers',
                                buzzHoldTimeout: settings.buzzHoldTimeout,
                                selectionTimeout: settings.selectionTimeout,
                                countdownDuration: settings.countdownDuration
                            }
                        }));
                    }
                }
            }
        });
    </script>
</body>
</html>
